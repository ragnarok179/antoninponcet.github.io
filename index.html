<!doctype html>
<html lang="fr">
<head>
    <title>Descent Into Hell</title>
    <link rel="icon" href="./images/favicon.png" type="image/png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/css.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

</head>
<body>
    <div class="window">
        <div class="world">
            <div class="item" id="Vindex" preload="none"><video <source id="Vindex"  autoplay muted loop type="video/mp4" ></video></div>
            <div class="item" id="index1"><p>Storytime créé par Antonin PONCET</p></div>
            <div class="item" id="index2"><h1>Descent Into Hell</h1></div>
            <div class="item" id="index3"><p>Découvrez une histoire pas comme les autres</p></div>
            <div id="buttonIndexContainer">
                <div class="item" id="buttonIndex"><p>Commencer</p></div>
            </div>

            <div class="item" id="indexBlack">
                <div class="scale-loop" id="index0"><h1>Pour une meilleure expérience, <span class="highlight-blue">presse F11</span> et active <span class="highlight-blue">le son</span> !<br>Le port <span class="highlight-blue">d'un casque</span> est fortement conseillé</h1>
                    <h1>Tu peux aussi passer certaines cinématiques en appuyant sur la <span class="highlight-blue">barre espace</span></h1></div>
                <div class="item" id="button0"><p>Suivant</p></div>
            </div>

            <div class="item" id="Vspaceship">
                <video muted type="video/mp4"><source src="./images/spaceship.mp4" id="Vspaceship"></video>
                <div id="button1"><p><strong style="font-size: 100px;">Saturne</strong></p></div>
            </div>

            <div class="item" id="Vspeed" preload="none"><video <source id="Vspeed" muted loop type="video/mp4" ></video></div>
            <div class="item" id="trans1"></div>
            <div class="item" id="spaceShip2"></div>

            <div class="item" id="Vsaturne" preload="none"><video <source id="Vsaturne" autoplay muted loop type="video/mp4" ></video></div>
            <div class="item" id="trans2"></div>
            <div class="item" id="VsaturneTrans" preload="none"><video <source  id="VsaturneTrans" type="video/mp4" ></video></div>
            <div class="item" id="Vanneaux" preload="none"><video <source id="Vanneaux" muted loop type="video/mp4" ></video></div>
            <div class="item" id="saturneFinal"></div>
            <div class="item" id="spaceShip3">
                <div class="item" id="button2"></div>
            </div>
            <div class="item" id="spaceShipON"></div>
            <div class="item" id="spaceShip4"></div>
            <div class="item" id="spaceShipOFFRed"></div>

            <div class="item" id="spaceShipRed">
                <div class="item" id="button3"></div>
                <div class="item" id="button4left"></div>
                <div class="item" id="button4right"></div>
                <div class="item" id="objectif">
                    <div id="Tobjectif">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMiddleG"></div>
            <div class="item" id="spaceshipMiddleGRed">
                <div class="item" id="button5left"></div>
                <div class="item" id="button5right"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMiddleD"></div>
            <div class="item" id="spaceshipMiddleDRed">
                <div class="item" id="button55left"></div>
                <div class="item" id="button55right"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMiddleB"></div>
            <div class="item" id="spaceshipMiddleBRed">
                <div class="item" id="button6left"></div>
                <div class="item" id="button6right"></div>
                <div class="item" id="button7"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMiddleOpen"></div>
            <div class="item" id="spaceshipMiddleOpenRed">
                <div class="item" id="buttonCenter"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipCoridor"></div>
            <div class="item" id="spaceshipCoridorRed">
                <div class="item" id="button8left"></div>
                <div class="item" id="button8right"></div>
                <div class="item" id="button8back"></div>
                <div class="item" id="button8front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipBed"></div>
            <div class="item" id="spaceshipBedRed">
                <div class="item" id="button9back"></div>
                <div class="item" id="button9front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipBedIntRobot">
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>
            <div class="item" id="spaceshipBedIntRobot1"></div>
            <div class="item" id="spaceshipBedIntRobot2"></div>
            <div class="item" id="spaceshipBedIntRobot3">
                <div class="item" id="buttonKakaka"></div>
            </div>
            <div class="item" id="spaceshipBedIntRobot4">
                <div class="item" id="buttonRobot"></div>
            </div>
            <div class="item" id="spaceshipBedIntRobot5"></div>
            <div class="item" id="spaceshipBedIntRobot6"></div>
            <div class="item" id="spaceshipBedIntRobot7"></div>
            <div class="item" id="spaceshipBedIntRobot8"></div>
            <div class="item" id="spaceshipBedIntRobot9">
                <div class="item" id="button22back"></div>
            </div>
            <div class="item" id="blood"></div>
            <div class="item" id="trans3"></div>

            <div class="item" id="spaceshipBedInt"></div>
            <div class="item" id="spaceshipBedIntRed">
                <div class="item" id="button10back"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMaintenance"></div>
            <div class="item" id="spaceshipMaintenanceRed">
                <div class="item" id="button11back"></div>
                <div class="item" id="button11front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipMaintenanceInt"></div>
            <div class="item" id="spaceshipMaintenanceIntLever"></div>
            <div class="item" id="spaceshipMaintenanceIntRed">
                <div class="item" id="button12back"></div>
                <div class="item" id="buttonAlarm"></div>
                <div class="item" id="buttonFuse1"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipCoridor2"></div>
            <div class="item" id="spaceshipCoridor2Red">
                <div class="item" id="button13left"></div>
                <div class="item" id="button13right"></div>
                <div class="item" id="button13back"></div>
                <div class="item" id="button13front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipEngine"></div>
            <div class="item" id="spaceshipEngineRed">
                <div class="item" id="button14back"></div>
                <div class="item" id="button14front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipEngineInt2">
                <div class="item" id="button21back"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipEngineInt"></div>
            <div class="item" id="spaceshipEngineIntRed">
                <div class="item" id="button15back"></div>
                <div class="item" id="buttonFuse"></div>
                <div class="item" id="buttonFuse3"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipTp"></div>
            <div class="item" id="spaceshipTpRed">
                <div class="item" id="button16back"></div>
                <div class="item" id="buttonTp"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipHold"></div>
            <div class="item" id="spaceshipHoldRed">
                <div class="item" id="button18back"></div>
                <div class="item" id="button18front"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipHoldInt"></div>
            <div class="item" id="spaceshipHoldIntRed">
                <div class="item" id="button19back"></div>
                <div class="item" id="buttonCase"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipHoldIntClose">
                <div class="item" id="buttonCase2"></div>
                <div class="item" id="button20back"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipHoldIntOpen">
                <div class="item" id="buttonFuse2"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="spaceshipWeapon"></div>
            <div class="item" id="spaceshipWeaponRed">
                <div class="item" id="shield"></div>
                <div id="laser"></div>
                <div id="laser1"></div>
                <div id="laser2"></div>
                <div class="item" id="cockpit"></div>
                <div class="item" id="cockpit2"></div>
                <div class="item" id="buttonTpback"></div>
                <div class="item" id="buttonTarget"></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="Vspeed2" preload="none"><video <source id="Vspeed2" muted loop type="video/mp4" ></video></div>
            <div class="item" id="Vearth" preload="none"><video <source id="Vearth" muted loop type="video/mp4" ></video></div>
            <div class="item" id="trans4"></div>
            <div class="item" id="spaceshipX">
                <div id="buttonX"><p><strong style="font-size: 100px;">???</strong></p></div>
                <div class="item" id="objectif2">
                    <div id="Tobjectif2">
                        <span id="objectifReduc"><strong><span class="taches-title">Tâches :</span></strong></span><br><span id="objectifReduc">- Désactiver la poussée</span><br><span id="Desalarme">- Désactiver l'alarme</span><br><span id="problème">- Identifier la cause de l'anomalie</span>
                    </div>
                </div>
            </div>

            <div class="item" id="black2">
                <div class="item" id="end"><h1><strong>End</strong></h1></div>
                <div class="item" id="text">
                    <p>Dans un avenir dystopique, un livreur du marché noir, à bord d'un vaisseau spatial, navigue à travers les étoiles et les dangers d'une galaxie contrôlée par des corporations et l'empire. Etant très bon dans les affaires, il a subi des implants cybernétiques qui améliorent ses capacités physiques et cognitives. Lui permettant ainsi d'ammasser encore plus d'oseilles.</p>
                    <p>Il est accompagné par une IA nommé Aegis sous la forme d'un crâne, un crâne robotique flottant qui l'aide à naviguer et se faufiler dans les systèmes de sécurité les plus avancés. Ce crâne est aussi sa seule compagnie, et les deux partagent une relation particulière : si l'IA est parfois exaspérante avec ses remarques cyniques, elle est aussi indispensable pour le guider. Ensemble, ils transportent des marchandises illégales pour des clients variés, des criminels aux rebelles, tout en évitant les forces de l'ordre galactiques.</p>
                    <p>Leurs aventures les mènent à travers des mondes oubliés et des stations spatiales en déclin, où ils se heurtent à des factions rivales et à des dangers imprévus. Il a aussi acquis grâce à la science une vitalité a toute épreuve, d'où ses 853 ans. Mais cette vitalité ne le rend pas pour autant invincible...</p>
                </div>
                <div class="item" id="recover"><p>Recommencer...</p></div>
            </div>

            <div class="item" id="cursorImage"> </div>
            <div class="item" id="kakaka"></div>
            <div class="bounce" id="left"> </div>
            <div class="bounce" id="right"> </div>
            <div class="bounce" id="front"> </div>
            <div class="bounce" id="back"> </div>
            <div class="item" id="target"></div>
            <div class="item" id="cursorPointer"> </div>
        </div>
    </div>




    <audio src="./audios/index.mp3" id="Aindex" loop></audio>
    <audio src="./audios/buttonIndex.mp3" id="AbuttonIndex"></audio>
    <audio src="./audios/ambient.mp3" loop id="Aambient"></audio>
    <audio src="./audios/start.mp3" id="Astart"></audio>
    <audio src="./audios/button1Start.mp3" id="Abutton1Start"></audio>
    <audio src="./audios/speed.mp3" id="Aspeed"></audio>
    <audio src="./audios/hyperspeed.mp3" id="Ahyperspeed"></audio>
    <audio src="./audios/saturne.mp3" id="Asaturne"></audio>
    <audio src="./audios/saturne2.mp3" id="Asaturne2"></audio>
    <audio src="./audios/alarme.mp3" loop id="Aalarme"></audio>
    <audio src="./audios/wesh.mp3" id="Awesh"></audio>
    <audio src="./audios/on.mp3" id="Aon"></audio>
    <audio src="./audios/off.mp3" id="Aoff"></audio>
    <audio src="./audios/door.mp3" id="Adoor"></audio>
    <audio src="./audios/lever.mp3" id="Alever"></audio>
    <audio src="./audios/film.mp3" id="Afilm"></audio>
    <audio src="./audios/ouf.mp3" id="Aouf"></audio>
    <audio src="./audios/fuse2.mp3" id="Afuse2"></audio>
    <audio src="./audios/fuse1.mp3" id="Afuse1"></audio>
    <audio src="./audios/fuse.mp3" id="Afuse"></audio>
    <audio src="./audios/steps.mp3" id="Asteps"></audio>
    <audio src="./audios/tp.mp3" id="Atp"></audio>
    <audio src="./audios/caseOpen.mp3" id="AcaseOpen"></audio>
    <audio src="./audios/caseFuse.mp3" id="AcaseFuse"></audio>
    <audio src="./audios/caseClose.mp3" id="AcaseClose"></audio>
    <audio src="./audios/bed.mp3" id="Abed"></audio>
    <audio src="./audios/bed1.mp3" id="Abed1"></audio>
    <audio src="./audios/bed2.mp3" id="Abed2"></audio>
    <audio src="./audios/bed3.mp3" id="Abed3"></audio>
    <audio src="./audios/take.mp3" id="Atake"></audio>
    <audio src="./audios/fall.mp3" id="Afall"></audio>
    <audio src="./audios/punch.mp3" id="Apunch"></audio>
    <audio src="./audios/bed4.mp3" id="Abed4"></audio>
    <audio src="./audios/memoire.mp3" id="Amemoire"></audio>
    <audio src="./audios/alarme2.mp3" id="Aalarme2"></audio>
    <audio src="./audios/danger.mp3" id="Adanger"></audio>
    <audio src="./audios/war.mp3" loop id="Awar"></audio>
    <audio src="./audios/shield.mp3" id="Ashield"></audio>
    <audio src="./audios/laser.mp3" id="Alaser"></audio>
    <audio src="./audios/spaceWar.mp3" id="AspaceWar"></audio>
    <audio src="./audios/endWar.mp3" id="AendWar"></audio>
    <audio src="./audios/now.mp3" id="Anow"></audio>
    <audio src="./audios/nan.mp3" id="Anan"></audio>
    <audio src="./audios/crash.mp3" id="Acrash"></audio>
    <audio id="Aend2" loop preload="none"></audio>




    <script src="js/jquery.js"></script>
    <script src="js/scrollbooster.min.js"></script>

    <script type="text/javascript">

        function hideElements() {
            const element = document.documentElement; 
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.mozRequestFullScreen) { 
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) { 
                element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) { 
                element.msRequestFullscreen();
            }
            $('#Aindex')[0].play();
            $('#AbuttonIndex')[0].play();
            $('#AbuttonIndex')[0].volume = 0.1;
            $('#indexBlack').fadeOut(2000);
            $('#index0').fadeOut(0);
            $('#button0').fadeOut(0, function () {
                $(this).css('display', 'none');
            });
            $(document).on('mousemove', CursorImage);
        }
        $('#button0').on('click', hideElements);
        $('#Vindex video')[0].src = "./images/index.mp4";
        $('#Vindex video')[0].load();
        $('#Vindex video')[0].play();


        function CursorImage(e) {
            if (!isFollow) {
                let worldOffset = $('.world').offset();
                let worldScrollLeft = $(window).scrollLeft();
                let worldScrollTop = $(window).scrollTop();

                $('#cursorImage').css({
                    visibility: 'visible',
                    left: e.pageX - worldOffset.left + worldScrollLeft + 'px',
                    top: e.pageY - worldOffset.top + worldScrollTop + 'px'
                });
                $('#cursorPointer').css({
                    visibility: 'hidden'
                });

                $('.window').css('cursor', 'none');
            } else {
                $('#cursorImage').css({
                    visibility: 'hidden'
                });
                $('#cursorPointer').css({
                    visibility: 'hidden'
                });
            }
        }

        function CursorPointer(e) {
            if (!isFollow) {
                let worldOffset = $('.world').offset();
                let worldScrollLeft = $(window).scrollLeft();
                let worldScrollTop = $(window).scrollTop();
                let imageWidth = $('#cursorImage').width() / 4;

                $('#cursorPointer').css({
                    visibility: 'visible',
                    left: e.pageX - imageWidth - worldOffset.left + worldScrollLeft + 'px',
                    top: e.pageY - worldOffset.top + worldScrollTop + 'px'
                });
                $('#cursorImage').css({
                    visibility: 'hidden'
                });

                $('.window').css('cursor', 'none');
            } else {
                $('#cursorImage').css({
                    visibility: 'hidden'
                });
                $('#cursorPointer').css({
                    visibility: 'hidden'
                });
            }
        }
        isFollow = false;
        let smoothX = 0;
        let smoothY = 0;

        const buttons = $('#buttonIndex, #button1, #button2, #button3, #button7, #buttonTp, #buttonAlarm, #buttonFuse, #buttonFuse1, #buttonCase, #buttonCase2, #buttonFuse2, #buttonFuse3, #buttonKakaka, #buttonRobot, #buttonX, #recover');

        buttons.on('mouseenter', function () {
            if (buttons.is(':visible')) {
                $(document).off('mousemove', CursorImage);
                $(document).on('mousemove', CursorPointer);
            } else if (buttons.is(':hidden')) {
                $(document).off('mousemove', CursorPointer);
                $(document).on('mousemove', CursorImage);
            }
        });

        buttons.on('mouseleave', function () {
            if (buttons.is(':visible')) {
                $(document).off('mousemove', CursorPointer);
                $(document).on('mousemove', CursorImage);
            }
        });

        $(function () {
            var worldView = new ScrollBooster({
                viewport: document.querySelector(".window"),
                emulateScroll: false,
                scrollMode: 'transform',
                bounce: false
            });

            var windowElement = document.querySelector('.window');

            windowElement.addEventListener('pointerdown', function (e) {
                e.preventDefault();
                e.preventDefault();
            });

            worldView.setPosition({
                x: 50,
                y: 0
            });

            var isFollowing = false;
            var isAnimating = false;
            let scrollX = 0, scrollY = 0;
            var x = 200, y = 200;
            var px = 0, py = 0;

            function startFollowingCursor() {
                $('#kakaka').css({
                    "transition": "none"
                });
                isFollow = true;
                isFollowing = true;

                $(document).on('mousemove.kakaka', function (e) {
                    if (isFollowing) {
                        px = e.pageX;
                        py = e.pageY;

                        if (px > x) {
                            $('#kakaka').css("background-image", "url(./images/kakakaD.png)");
                        } else {
                            $('#kakaka').css("background-image", "url(./images/kakakaG.png)");
                        }
                    }
                });

                setInterval(function () {
                    if (isFollowing) {
                        updateScrollPosition0();
                        x += (px - x) / 20;
                        y += (py - y) / 20;

                        $('#kakaka').css({
                            left: x - scrollX,
                            top: y - scrollY
                        });
                    }
                }, 15);
            }

            function updateScrollPosition0() {
                const transformMatrix = getComputedStyle(document.querySelector('.world')).transform;
                if (transformMatrix !== 'none') {
                    const matrixValues = transformMatrix.split(',');
                    scrollX = parseFloat(matrixValues[4]) || 0;
                    scrollY = parseFloat(matrixValues[5]) || 0;
                } else {
                    scrollX = 0;
                    scrollY = 0;
                }
            }

            function startAnimation() {
                if (isAnimating) return;

                isAnimating = true;
                animateKakaka();
            }

            function animateKakaka() {
                $('#kakaka').animate({ top: '+=10px' }, 500)
                    .animate({ top: '-=10px' }, 500, function () {
                        if (isAnimating) animateKakaka();
                    });
            }

            function stopFollowingCursor() {
                isFollowing = false;
                isFollow = false;
                $(document).off('mousemove.kakaka');
            }

            function stopAnimation() {
                isAnimating = false;
                $('#kakaka').stop(true, true);
            }

            $('#buttonIndex').on('click', function () {
                stopAnimation();
                startFollowingCursor();
                isFollow = true;
                $('#Aindex')[0].remove();
                $('#Astart')[0].play();
                $('#AbuttonIndex')[0].play();
                $('#AbuttonIndex')[0].volume = 0.1;
                $('#Aambient')[0].play();
                $('#Aambient')[0].volume = 0.4;
                $('#Vindex video')[0].remove();
                worldView.setPosition({
                    x: 3000,
                    y: 0
                });
                $(document).off('keydown').on('keydown', function (e) {
                    if (e.key === ' ') {
                        e.preventDefault();
                        let audioElement = $('#Astart')[0];
                        if (audioElement.duration > 0.5) {
                            audioElement.currentTime = audioElement.duration - 0.5;
                        }
                    }
                });

                $('#Astart')[0].addEventListener('ended', function () {
                    $('#Abutton1Start')[0].play();
                    $('#Abutton1Start')[0].volume = 0.3;
                    stopFollowingCursor();
                    isFollow = false;
                    $('#kakaka').css({
                        "background-image": "url(./images/kakakaD.png)",
                        "transform": "scale(1.5)",
                        "left": "3200px",
                        "top": "360px",
                        "transition": "left 2s, top 2s, transform 2s"
                    });
                    setTimeout(function () {
                        $('#Vspaceship video')[0].play();
                        setTimeout(function () {
                            $('#button1').css('visibility', 'visible');
                        }, 2000);
                    });
                });
            });

            $('#button1').on('click', function () {
                startAnimation();
                $('#Ahyperspeed')[0].play();
                setTimeout(function () {
                    $('#Aspeed')[0].play();
                }, 900);
                $('#Vspaceship').remove();
                $(document).off('mousemove', CursorPointer);
                $(document).on('mousemove', CursorImage);

                $('#kakaka').css({
                    transition: 'none',
                    left: 6200,
                    top: 360
                });

                $('#Vspeed video')[0].src = "./images/index.mp4";
                $('#Vspeed video')[0].load();
                $('#Vspeed video')[0].play();
                $('#Vspeed video')[0].playbackRate = 5;

                let initialX = $('#Vspeed').offset().left;
                let initialY = $('#Vspeed').offset().top;

                const moveDistance = 10;
                $(document).on('mousemove', function (e) {
                    let mouseX = e.pageX - $(window).width() / 2;
                    let mouseY = e.pageY - $(window).height() / 2;

                    let maxMoveX = $(window).width() / 4;
                    let maxMoveY = $(window).height() / 4;

                    let offsetX = Math.min(Math.max((mouseX / maxMoveX) * moveDistance, -moveDistance), moveDistance);
                    let offsetY = Math.min(Math.max((mouseY / maxMoveY) * moveDistance, -moveDistance), moveDistance);

                    $('#Vspeed').css({
                        transform: `translate(${offsetX}px, ${offsetY}px)`
                    });
                });

                worldView.setPosition({
                    x: 6000,
                    y: 0
                });
                $('#trans1').css({
                    "opacity": "0",
                    "transition": "opacity 2s"
                });

                setTimeout(function () {
                    $('#Vspeed video')[0].remove();
                    $('#Vspeed').css({ transform: 'translate(0, 0)' });
                    $('#Asaturne')[0].play();

                    $(document).off('keydown').on('keydown', function (e) {
                        if (e.key === ' ') {
                            e.preventDefault();
                            let audioElement = $('#Asaturne')[0];
                            if (audioElement.duration > 0.5) {
                                audioElement.currentTime = audioElement.duration - 0.5;
                            }
                        }
                    });

                    worldView.setPosition({
                        x: 9000,
                        y: 0
                    });
                    $('#kakaka').css({
                        transition: 'none',
                        left: 9200,
                        top: 360
                    });
                    $('#trans2').css({
                        "opacity": "0",
                        "transition": "opacity 3s"
                    });
                }, 7000);

                $('#Vsaturne video').css('visibility', 'visible');
                $('#Vsaturne video')[0].src = "./images/saturne.mp4";
                $('#Vsaturne video')[0].load();
            });



            const moveDistance = 10;
            const videoElement = $('#Vsaturne video')[0];

            let initialY = $('#Vsaturne').offset().top;

            $(document).on('mousemove', function (e) {
                let mouseY = e.pageY - $(window).height() / 2;
                let maxMoveY = $(window).height() / 2;
                let offsetY = Math.min(Math.max((mouseY / maxMoveY) * moveDistance, -moveDistance), moveDistance);

                $('#Vsaturne').css({
                    transform: `translateY(${offsetY}px)`
                });
            });

            $('#button2').on('click', function () {
                $('#Asaturne')[0].pause();
                $('#Asaturne')[0].remove();
                $('#Aon')[0].play();
                $('#Aon')[0].volume = 0.4;
                $('#spaceShip1').css('display', 'none');
                $('#spaceShip2').css('display', 'none');
                $('#Vspeed').remove();
                $('#spaceShip3').css('display', 'none');
                $('#spaceShipON').css('visibility', 'visible');
                $('#VsaturneTrans video')[0].src = "./images/saturneTrans.mp4";
                $('#VsaturneTrans video')[0].load();
                $('#VsaturneTrans video')[0].play();
                $('#Vsaturne video').remove();
                $('#VsaturneTrans video').css('visibility', 'visible');

                setTimeout(function () {
                    $('#Vanneaux video').css('visibility', 'visible');
                    $('#Vanneaux video')[0].src = "./images/anneaux.mp4";
                    $('#Vanneaux video')[0].load();
                    $('#Vanneaux video')[0].play();
                }, 6370);

                $('#VsaturneTrans video').on('ended', function () {
                    $('#Asaturne2')[0].play();
                    $(document).off('keydown').on('keydown', function (e) {
                        if (e.key === ' ') {
                            e.preventDefault();
                            let audioElement = $('#Asaturne2')[0];
                            if (audioElement.duration > 0.5) {
                                audioElement.currentTime = audioElement.duration - 0.5;
                            }
                        }
                    });
                    $('#VsaturneTrans video').remove();

                    const moveDistance = 10;
                    const videoElement = $('#Vanneaux video')[0];

                    let initialY = $('#Vanneaux').offset().top;

                    $(document).on('mousemove', function (e) {
                        let mouseY = e.pageY - $(window).height() / 2;
                        let maxMoveY = $(window).height() / 4;
                        let offsetY = Math.min(Math.max((mouseY / maxMoveY) * moveDistance, -moveDistance), moveDistance);

                        $('#Vanneaux').css({
                            transform: `translateY(${offsetY}px)`
                        });
                    });
                });

                $('#Asaturne2')[0].addEventListener('ended', function () {
                    setTimeout(function () {
                        $('#Awesh')[0].play();
                        $(document).off('keydown').on('keydown', function (e) {
                            if (e.key === ' ') {
                                e.preventDefault();
                                let audioElement = $('#Awesh')[0];
                                if (audioElement.duration > 0.5) {
                                    audioElement.currentTime = audioElement.duration - 0.5;
                                }
                            }
                        });
                    }, 500);
                    $('#Aalarme')[0].play();
                    $('#Aalarme')[0].volume = 0.4;
                    $('#spaceShip3').css('visibility', 'hidden');
                    $('#spaceShipRed').css('visibility', 'visible');

                    var number = 1;
                    var toggleInterval;
                    var disableLoop = false;

                    function toggleImage() {
                        var images = [
                            "#spaceShipRed", "#spaceShipOFFRed", "#spaceshipMiddleGRed", "#spaceshipMiddleBRed", "#spaceshipMiddleDRed",
                            "#spaceshipMiddleOpenRed", "#spaceshipCoridorRed", "#spaceshipBedRed", "#spaceshipBedIntRed",
                            "#spaceshipMaintenanceRed", "#spaceshipMaintenanceIntRed", "#spaceshipCoridor2Red", "#spaceshipEngineRed", "#spaceshipEngineIntRed",
                            "#spaceshipTpRed", "#spaceshipHoldRed", "#spaceshipHoldIntRed", "#spaceshipWeaponRed"
                        ];

                        if (disableLoop) {
                            clearInterval(toggleInterval);
                            images.forEach(function (selector) {
                                $(selector).css("visibility", "hidden");
                            });
                            return;
                        }

                        images.forEach(function (selector, index) {
                            var image = $(selector);
                            if (number === 2 && selector === "#spaceShipRed") {
                                $('#spaceShipRed').css('visibility', 'hidden');
                                return;
                            }
                            if (index !== 0 || (number === 1 && !disableLoop)) {
                                image.css("visibility", image.css("visibility") === "hidden" ? "visible" : "hidden");
                            }
                        });
                    }

                    toggleInterval = setInterval(toggleImage, 1000);

                    $('#Awesh')[0].addEventListener('ended', function () {
                        $('#objectif').css('visibility', 'visible');
                        $('#objectif2').css('visibility', 'visible');
                        $('#button3').css('visibility', 'visible');

                        $('#button3').on('click', function () {
                            var next4 = 0
                            number = 2;
                            $('#Aoff')[0].play();
                            $('#Aoff')[0].volume = 0.4;
                            $('#spaceshipMiddleG').css('visibility', 'visible');
                            $('#spaceshipMiddleD').css('visibility', 'visible');
                            $('#spaceshipMiddleB').css('visibility', 'visible');
                            $('#button6left').css('visibility', 'visible');
                            $('#button6right').css('visibility', 'visible');
                            $('#button55left').css('visibility', 'visible');
                            $('#button55right').css('visibility', 'visible');
                            $('#button5left').css('visibility', 'visible');
                            $('#button5right').css('visibility', 'visible');
                            $('#spaceShip4').css('visibility', 'visible');
                            $('#spaceShipON').css('display', 'none');
                            $('#button4left').css('visibility', 'visible');
                            $('#button4right').css('visibility', 'visible');
                            $('#button3').css('display', 'none');
                            $("#buttonTpback").css('visibility', 'visible');
                            $("#buttonTp").css('visibility', 'visible');

                            $('#Vanneaux video').on('timeupdate', function () {
                                var remainingTime = this.duration - this.currentTime;

                                if (remainingTime <= 5) {
                                    this.playbackRate = remainingTime / 5;
                                }

                                if (remainingTime <= 0.5) {
                                    this.pause();
                                    this.playbackRate = 1;
                                    $('#Vanneaux video').off('timeupdate');
                                    $('#Vanneaux video').off('click');
                                    $('#Vanneaux video').remove();
                                    $('#saturneFinal').css('visibility', 'visible');
                                }
                            });

                            $('#spaceShipRed').css('display', 'hidden');
                            $('#spaceShipOFFRed').css({
                                left: 9000,
                                top: 0
                            });

                            $("[id*='objectifReduc']").each(function () {
                                $(this).html(function (_, html) {
                                    return html.replace('- Désactiver la poussée', '<span style="color: red;"><del>Désactiver la poussée</del></span>');
                                });
                            });

                            function updateCursorPosition(e, offsetX = 0, offsetY = 0) {
                                let scrollTop = window.scrollY;
                                let viewportWidth = $(window).width();
                                let viewportHeight = $(window).height();
                                let cursorX = e.pageX, cursorY = e.pageY;

                                let newLeft = Math.max(0, Math.min(cursorX - $('#left').width() / 2, viewportWidth - $('#left').width()));
                                let newTop = Math.max(0, Math.min(cursorY - $('#left').height() / 2, viewportHeight - $('#left').height()));

                                let leftBoundary = viewportWidth * 0.3, rightBoundary = viewportWidth * 0.7;

                                let buttons = [
                                    { id: '#buttonCenter' },
                                    { id: '#button7' },
                                    { id: '#button8front', isFront: true },
                                    { id: '#button8back', isFront: false },
                                    { id: '#button13front', isFront: true },
                                    { id: '#button13back', isFront: false }
                                ];

                                let isOverButtonCenter = false;
                                let isOverButton7 = false;
                                let activeButton = null;

                                for (let button of buttons) {
                                    let offset = $(button.id).offset();
                                    let width = $(button.id).width();
                                    let height = $(button.id).height();

                                    if (button.id === '#buttonCenter') {
                                        isOverButtonCenter = cursorX >= offset.left && cursorX <= offset.left + width &&
                                            cursorY >= offset.top && cursorY <= offset.top + height;
                                    } else if (button.id === '#button7') {
                                        isOverButton7 = cursorX >= offset.left && cursorX <= offset.left + width &&
                                            cursorY >= offset.top && cursorY <= offset.top + height;
                                    } else if (cursorX >= offset.left && cursorX <= offset.left + width &&
                                        cursorY >= offset.top && cursorY <= offset.top + height) {
                                        activeButton = button;
                                    }
                                }

                                if (cursorX <= leftBoundary) {
                                    $('#left').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                    $('#right, #front, #back').css('visibility', 'hidden');
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                } else if (cursorX >= rightBoundary) {
                                    $('#right').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                    $('#left, #front, #back').css('visibility', 'hidden');
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                } else if (isOverButtonCenter) {
                                    $('#front').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                    $('#left, #right, #back').css('visibility', 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                    $('#cursorImage').css("visibility", 'hidden');
                                } else if (isOverButton7) {
                                    $('#front').css("visibility", 'hidden');
                                    $('#left, #right, #back').css('visibility', 'hidden');
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $('#cursorPointer').css("visibility", 'visible');
                                } else if (activeButton) {
                                    if (activeButton.isFront) {
                                        $('#front').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                        $('#back').css('visibility', 'hidden');
                                    } else {
                                        $('#back').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                        $('#front').css('visibility', 'hidden');
                                    }
                                    $('#left, #right').css('visibility', 'hidden');
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                } else {
                                    $('#left, #right, #front, #back').css('visibility', 'hidden');
                                    $('#cursorImage').css('visibility', 'visible');
                                    $(document).on('mousemove', CursorImage);
                                }
                            }


                            function updateCursorPosition2(e, offsetX = 0, offsetY = 0) {
                                let scrollTop = window.scrollY;
                                let viewportWidth = $(window).width();
                                let viewportHeight = $(window).height();
                                let cursorX = e.pageX, cursorY = e.pageY;

                                let imageWidth = $('#front').width(), imageHeight = $('#front').height();
                                let newLeft = Math.max(0, Math.min(cursorX - imageWidth / 2, viewportWidth - imageWidth));
                                let newTop = Math.max(0, Math.min(cursorY - imageHeight / 2, viewportHeight - imageHeight));

                                let buttons = [
                                    { id: '#buttonTp', type: 'other' },
                                    { id: '#buttonAlarm', type: 'other' },
                                    { id: '#buttonFuse', type: 'other' },
                                    { id: '#buttonFuse1', type: 'other' },
                                    { id: '#buttonCase', type: 'other' },
                                    { id: '#buttonCase2', type: 'other' },
                                    { id: '#buttonFuse2', type: 'other' },
                                    { id: '#buttonFuse3', type: 'other' },
                                    { id: '#buttonRobot', type: 'other' },
                                    { id: '#buttonKakaka', type: 'other' },
                                    { id: '#buttonTarget', type: 'other' },
                                    { id: '#button8front', type: 'front' },
                                    { id: '#button9front', type: 'front' },
                                    { id: '#button11front', type: 'front' },
                                    { id: '#button13front', type: 'front' },
                                    { id: '#button14front', type: 'front' },
                                    { id: '#button18front', type: 'front' },
                                    { id: '#button8back', type: 'back' },
                                    { id: '#button9back', type: 'back' },
                                    { id: '#button10back', type: 'back' },
                                    { id: '#button11back', type: 'back' },
                                    { id: '#button12back', type: 'back' },
                                    { id: '#button13back', type: 'back' },
                                    { id: '#button14back', type: 'back' },
                                    { id: '#button15back', type: 'back' },
                                    { id: '#button16back', type: 'back' },
                                    { id: '#button18back', type: 'back' },
                                    { id: '#button19back', type: 'back' },
                                    { id: '#buttonTpback', type: 'back' },
                                    { id: '#button20back', type: 'back' },
                                    { id: '#button21back', type: 'back' },
                                    { id: '#button22back', type: 'back' }
                                ];

                                let activeButton = null;

                                for (let button of buttons) {
                                    let offset = $(button.id).offset();
                                    let width = $(button.id).width();
                                    let height = $(button.id).height();

                                    if (cursorX >= offset.left && cursorX <= offset.left + width &&
                                        cursorY >= offset.top && cursorY <= offset.top + height) {
                                        activeButton = button;
                                        break;
                                    }
                                }

                                if (activeButton) {
                                    if (activeButton.type === 'front') {
                                        $('#front').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                        $('#back').css('visibility', 'hidden');
                                    } else if (activeButton.type === 'back') {
                                        $('#back').css({ visibility: 'visible', left: newLeft + offsetX, top: newTop + scrollTop + offsetY });
                                        $('#front').css('visibility', 'hidden');
                                    } else {
                                        $('#front, #back, #left, #right').css('visibility', 'hidden');
                                    }
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                } else {
                                    $('#front, #back').css('visibility', 'hidden');
                                    $('#cursorImage').css('visibility', 'visible');
                                    $(document).on('mousemove', CursorImage);
                                }
                            }


                            function updateCursorPosition3(e, offsetX = 0, offsetY = 0) {
                                let cursorX = e.pageX, cursorY = e.pageY;

                                let buttons = [
                                    '#buttonTp', '#buttonAlarm', '#buttonFuse', '#buttonFuse1',
                                    '#buttonCase', '#buttonCase2', '#buttonFuse2', '#buttonFuse3',
                                    '#buttonKakaka', '#buttonRobot', '#buttonTarget', '#buttonX', '#recover'
                                ];

                                let isOverButton = false;
                                buttons.forEach(button => {
                                    let $buttonElem = $(button);
                                    let offset = $buttonElem.offset();

                                    if (offset) {
                                        let width = $buttonElem.width();
                                        let height = $buttonElem.height();

                                        if (cursorX >= offset.left && cursorX <= offset.left + width &&
                                            cursorY >= offset.top && cursorY <= offset.top + height) {
                                            isOverButton = button;
                                        }
                                    }
                                });

                                if (isOverButton) {
                                    $('#front, #left, #right, #back').css("visibility", 'hidden');
                                    $(document).off('mousemove', CursorImage);
                                    $('#cursorImage').css("visibility", 'hidden');
                                    $('#cursorPointer').css("visibility", isOverButton === '#buttonTarget' ? 'hidden' : 'visible');
                                } else {
                                    $('#front, #left, #right, #back').css("visibility", 'hidden');
                                    $('#cursorImage').css('visibility', 'visible');
                                    $(document).on('mousemove', CursorImage);
                                }
                            }


                            $(document).on('mousemove', function (e) {
                                updateCursorPosition(e, 9000, 0);
                            });

                            $('#button4left').on('click', function () {
                                $('#Asteps')[0].play();
                                $('#Asteps')[0].volume = 0.4;
                                $('#Vanneaux video').remove();
                                $('#saturneFinal').css('visibility', 'visible');
                                worldView.setPosition({ x: 50, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 3000);
                                });
                            });

                            $('#button4right').on('click', function () {
                                $('#Asteps')[0].play();
                                $('#Vanneaux video').remove();
                                $('#saturneFinal').css('visibility', 'visible');
                                worldView.setPosition({ x: 6000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 6000, 3000);
                                });
                            });

                            $('#button55left, #button5right').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 9000, y: 0 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 0);
                                });
                                if (next4 === 1) {
                                    $('#kakaka').css({
                                        transition: 'none',
                                        left: 9000,
                                        top: 0
                                    });
                                    $("[id='nouvelleTache7']").html(function (_, html) {
                                        return html.replace('- Fuyez, pauvres fous !!', '<span style="color: red;"><del>Fuyez, pauvres fous !!</del></span>');
                                    });
                                    $('#left, #right, #back, #front').css('display', 'none');
                                    $('#button4right').remove();
                                    $('#button4left').remove();
                                    $(document).off('mousemove', function (e) {
                                        updateCursorPosition(e, 9000, 0);
                                    });
                                    $(document).off('mousemove', function (e) {
                                        updateCursorPosition2(e, 9000, 0);
                                    });
                                    $(document).on('mousemove', function (e) {
                                        updateCursorPosition3(e, 9000, 0);
                                    });
                                    if (!$('#AendWar')[0].ended) {
                                        $('#AendWar').one('ended', function () {
                                            $('#kakaka').css({
                                                transition: 'none',
                                                left: 0,
                                                top: 15000
                                            });
                                            $('#Anow')[0].play();
                                            $('#spaceshipX, #saturneFinal').css({
                                                left: 0,
                                                top: 15000
                                            });
                                            worldView.setPosition({
                                                x: 0,
                                                y: 15000
                                            });
                                            $(document).on('mousemove', function (e) {
                                                updateCursorPosition3(e, 0, 15000);
                                            });
                                            $('#Anow').one('ended', function () {
                                                
                                                $('#Abutton1Start')[0].play();
                                                $('#Abutton1Start')[0].currentTime = 0;
                                                $('#Abutton1Start').one('ended', function () {
                                                    
                                                    $('#buttonX').css('visibility', 'visible');
                                                    $('#buttonX').on('click', function () {
                                                        const fadeOut = setInterval(function () {
                                                            const audio = $('#Awar')[0];
                                                            if (audio.volume > 0) {
                                                                audio.volume = Math.max(audio.volume - 0.1, 0);
                                                            } else {
                                                                clearInterval(fadeOut);
                                                                audio.pause();
                                                            }
                                                        }, 200);
                                                        setInterval(function () {
                                                            $('#Awar')[0].pause();
                                                        }, 200);
                                                        $("#objectif2").hide();
                                                        $('#trans4').css({
                                                            left: 0,
                                                            top: 15000
                                                        });
                                                        $('#trans4').css({
                                                            "opacity": "0",
                                                            "transition": "opacity 2s"
                                                        });
                                                        setTimeout(function () {
                                                            $('#trans4').css({
                                                                "opacity": "1",
                                                                "transition": "none"
                                                            });
                                                            $('#trans4').css({
                                                                left: 12000,
                                                                top: 0
                                                            });
                                                        }, 1000);
                                                        $('#Ahyperspeed')[0].play();
                                                        $('#Ahyperspeed')[0].currentTime = 0;
                                                        $('#buttonX')[0].remove();
                                                        $('#saturneFinal')[0].remove();
                                                        $('#Vspeed2 video')[0].src = "./images/index.mp4";
                                                        $('#Vspeed2 video')[0].load();
                                                        $('#Vspeed2 video')[0].play();
                                                        $('#Vspeed2 video')[0].playbackRate = 5;
                                                        setTimeout(function () {
                                                            $('#Acrash')[0].play();
                                                            $('#trans4').css({
                                                                left: 0,
                                                                top: 15000
                                                            });
                                                            $('#trans4').css({
                                                                "opacity": "0",
                                                                "transition": "opacity 3s"
                                                            });
                                                            $('#Anan')[0].play();
                                                            $('#Vspeed2 video')[0].remove();
                                                            $('#Vearth video')[0].src = "./images/earth.mp4";
                                                            $('#Vearth video')[0].load();
                                                            $('#Vearth video')[0].play();
                                                            setTimeout(function () {
                                                                $('#Aend')[0].play();
                                                            }, 1373);
                                                            setTimeout(function () {
                                                                $('#Acrash')[0].pause();
                                                                $(document).on('mousemove', function (e) {
                                                                    updateCursorPosition3(e, 3000, 15000);
                                                                });
                                                                setTimeout(function () {
                                                                    $('#black2').css('opacity', 0).fadeTo(7000, 1);
                                                                }, 5000);
                                                                $('#Vearth video')[0].remove();
                                                                worldView.setPosition({
                                                                    x: 3000,
                                                                    y: 15000
                                                                });
                                                                $('#recover').on('click', function () {
                                                                    location.reload();
                                                                });
                                                                $('#Aend2').attr('src', './audios/end2.mp3').get(0).play();
                                                                $('#Aend2')[0].currentTime = 28;
                                                                $('#Aend2')[0].volume = 0;

                                                                let volumeInterval = setInterval(function () {
                                                                    let currentVolume = $('#Aend2')[0].volume;
                                                                    if (currentVolume < 1) {
                                                                        $('#Aend2')[0].volume = Math.min(currentVolume + 0.01, 1);
                                                                    } else {
                                                                        clearInterval(volumeInterval);
                                                                    }
                                                                }, 100);
                                                            }, 2000);
                                                        }, 7000);
                                                    });
                                                });
                                            });
                                        });
                                    } else {
                                        $('#kakaka').css({
                                            transition: 'none',
                                            left: 0,
                                            top: 15000
                                        });
                                        $('#Anow')[0].play();
                                        $('#spaceshipX, #saturneFinal').css({
                                            left: 0,
                                            top: 15000
                                        });
                                        worldView.setPosition({
                                            x: 0,
                                            y: 15000
                                        });
                                        $(document).on('mousemove', function (e) {
                                            updateCursorPosition3(e, 0, 15000);
                                        });
                                        $('#Anow').one('ended', function () {
                                            
                                            $('#Abutton1Start')[0].play();
                                            $('#Abutton1Start')[0].currentTime = 0;
                                            $('#Abutton1Start').one('ended', function () {
                                                $('#buttonX').css('visibility', 'visible');
                                                $('#buttonX').on('click', function () {
                                                    const fadeOut = setInterval(function () {
                                                        const audio = $('#Awar')[0];
                                                        if (audio.volume > 0) {
                                                            audio.volume = Math.max(audio.volume - 0.1, 0);
                                                        } else {
                                                            clearInterval(fadeOut);
                                                            audio.pause();
                                                        }
                                                    }, 200);
                                                    setInterval(function () {
                                                        $('#Awar')[0].pause();
                                                    }, 200);
                                                    $("#objectif2").hide();
                                                    $('#trans4').css({
                                                        left: 0,
                                                        top: 15000
                                                    });
                                                    $('#trans4').css({
                                                        "opacity": "0",
                                                        "transition": "opacity 2s"
                                                    });
                                                    setTimeout(function () {
                                                        $('#trans4').css({
                                                            "opacity": "1",
                                                            "transition": "none"
                                                        });
                                                        $('#trans4').css({
                                                            left: 12000,
                                                            top: 0
                                                        });
                                                    }, 1000);
                                                    $('#Ahyperspeed')[0].play();
                                                    $('#Ahyperspeed')[0].currentTime = 0;
                                                    $('#buttonX')[0].remove();
                                                    $('#saturneFinal')[0].remove();
                                                    $('#Vspeed2 video')[0].src = "./images/index.mp4";
                                                    $('#Vspeed2 video')[0].load();
                                                    $('#Vspeed2 video')[0].play();
                                                    $('#Vspeed2 video')[0].playbackRate = 5;
                                                    setTimeout(function () {
                                                        $('#Acrash')[0].play();
                                                        $('#trans4').css({
                                                            left: 0,
                                                            top: 15000
                                                        });
                                                        $('#trans4').css({
                                                            "opacity": "0",
                                                            "transition": "opacity 3s"
                                                        });
                                                        $('#Anan')[0].play();
                                                        $('#Vspeed2 video')[0].remove();
                                                        $('#Vearth video')[0].src = "./images/earth.mp4";
                                                        $('#Vearth video')[0].load();
                                                        $('#Vearth video')[0].play();
                                                        setTimeout(function () {
                                                            $('#Aend')[0].play();
                                                        }, 1373);
                                                        setTimeout(function () {
                                                            $('#Acrash')[0].pause();
                                                            $(document).on('mousemove', function (e) {
                                                                updateCursorPosition3(e, 3000, 15000);
                                                            });
                                                            setTimeout(function () {
                                                                $('#black2').css('opacity', 0).fadeTo(7000, 1);
                                                            }, 5000);
                                                            $('#Vearth video')[0].remove();
                                                            worldView.setPosition({
                                                                x: 3000,
                                                                y: 15000
                                                            });
                                                            $('#recover').on('click', function () {
                                                                location.reload();
                                                            });
                                                            $('#Aend2').attr('src', './audios/end2.mp3').get(0).play();
                                                            $('#Aend2')[0].currentTime = 28;
                                                            $('#Aend2')[0].volume = 0;

                                                            let volumeInterval = setInterval(function () {
                                                                let currentVolume = $('#Aend2')[0].volume;
                                                                if (currentVolume < 1) {
                                                                    $('#Aend2')[0].volume = Math.min(currentVolume + 0.01, 1);
                                                                } else {
                                                                    clearInterval(volumeInterval);
                                                                }
                                                            }, 100);
                                                        }, 2000);
                                                    });
                                                });
                                            });
                                        });
                                    }
                                }
                            });


                            $('#button55right, #button5left').on('click', function () {
                                $('#Asteps')[0].play();
                                $('#button7').css('visibility', 'visible');
                                worldView.setPosition({ x: 3000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 3000, 3000);
                                });
                            });

                            $('#button6right').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 50, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 3000);
                                });
                            });

                            $('#button6left').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 6000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 6000, 3000);
                                });
                            });

                            $('#button7').on('click', function () {
                                $('#Adoor')[0].play();
                                $('#Adoor')[0].volume = 0.6;
                                $('#spaceshipMiddleB').css('display', 'hidden');
                                $('#spaceshipMiddleOpen').css('visibility', 'visible');
                                $('#buttonCenter').css('visibility', 'visible');
                                $('#button7').css('display', 'none');
                                $('#spaceshipMiddleOpenRed, #spaceshipMiddleOpen').css({ left: 3000, top: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 3000, 3000);
                                });
                            });

                            $('#buttonCenter').on('click', function () {
                                $('#Asteps')[0].play();
                                $('#spaceshipCoridor').css('visibility', 'visible');
                                $('#button8left, #button8right, #button8front, #button8back').css('visibility', 'visible');
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                            });

                            $('#button8back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 3000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 3000, 3000);
                                });
                            });

                            $('#button8left').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button9front, #button9back, #spaceshipBed").css('visibility', 'visible');
                                worldView.setPosition({ x: 50, y: 6000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 6000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 6000);
                                });
                            });

                            $('#button11back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 3000);
                                });
                            });

                            $('#button11front').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button12back, #spaceshipMaintenanceInt, #buttonAlarm, #buttonFuse1").css('visibility', 'visible');
                                worldView.setPosition({ x: 9000, y: 6000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 6000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 6000);
                                });
                            });


                            $('#buttonAlarm').on('click', function () {
                                next2 = 1;
                                $("#buttonFuse1, #button12back").css('visibility', 'hidden');
                                $("#spaceshipMaintenanceIntLever").css('visibility', 'visible');
                                $('#Aalarme')[0].pause();
                                $('#Alever')[0].play();
                                setTimeout(function () {
                                    $('#Aouf')[0].play();
                                    $(document).off('keydown').on('keydown', function (e) {
                                        if (e.key === ' ') {
                                            e.preventDefault();
                                            let audioElement = $('#Aouf')[0];
                                            if (audioElement.duration > 0.5) {
                                                audioElement.currentTime = audioElement.duration - 0.5;
                                            }
                                        }
                                    });
                                }, 1000);
                                $('#Alever')[0].volume = 0.4;
                                disableLoop = true;
                                $("#buttonAlarm").css('display', 'none');
                                $("[id*='Desalarme']").each(function () {
                                    $(this).html(function (_, html) {
                                        return html.replace('- Désactiver l\'alarme', '<span style="color: red;"><del>Désactiver l\'alarme</del></span>');
                                    });
                                });
                                $('#Aouf')[0].addEventListener('ended', function () {
                                    $("#buttonFuse1, #button12back").css('visibility', 'visible');
                                });
                                setTimeout(function () {
                                    $("#spaceshipMaintenanceIntLever").remove();
                                }, 1500);
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 6000);
                                });
                                if (next0 === 1 && next2 === 1) {
                                    $('#Aouf').on('ended', function () {
                                        $("#buttonCase").css('visibility', 'visible');
                                        $("[id='objectifReduc']").nextAll().remove();
                                        $("[id='objectifReduc']").after(`<br><span id="nouvelleTache1">- Chercher un fusible</span> <br><span id="nouvelleTache2">- Installer le fusible</span>`);
                                    });
                                }
                            });

                            $('#buttonFuse1').on('click', function () {
                                $('#Afuse2')[0].play();
                                $("#buttonAlarm, #button12back").css('visibility', 'hidden');
                                $('#Afuse2')[0].addEventListener('ended', function () {
                                    $("#buttonAlarm, #button12back").css('visibility', 'visible');
                                });
                                $("#buttonFuse1").css('display', 'none');
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 6000);
                                });
                            });

                            $('#button12back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 3000);
                                });
                            });

                            $('#button8right').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button11front, #button11back, #spaceshipMaintenance").css('visibility', 'visible');
                                worldView.setPosition({ x: 6000, y: 6000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 6000, 6000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 6000, 6000);
                                });
                            });

                            $('#button9back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 3000);
                                });
                            });

                            $('#button9front').one('click', function () {
                                if (next !== 1) {
                                    $('#Afilm')[0].play();
                                    $('#Asteps')[0].play();
                                    $("#button10back, #spaceshipBedInt").css('visibility', 'visible');
                                    worldView.setPosition({ x: 3000, y: 6000 });
                                    $(document).on('mousemove', function (e) {
                                        updateCursorPosition2(e, 3000, 6000);
                                    });
                                }
                            });

                            var next = 0;
                            $('#button9front').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button10back, #spaceshipBedInt").css('visibility', 'visible');
                                worldView.setPosition({ x: 3000, y: 6000 });
                                $(document).on('mousemove').on('mousemove', function (e) {
                                    updateCursorPosition2(e, 3000, 6000);
                                });

                                if (next === 1) {
                                    stopAnimation();
                                    $('#kakaka').css({
                                        "transform": "scale(1.5)",
                                        "left": "3360px",
                                        "top": "6220px",
                                        "transition": "left 2s, top 2s, transform 2s"
                                    });
                                    $('#Abed1')[0].play();
                                    $("[id*='nouvelleTache3']").each(function () {
                                        $(this).html(function (_, html) {
                                            return html.replace('- Aller dans la chambre', '<span style="color: red;"><del>Aller dans la chambre</del></span>');
                                        });
                                    });
                                    $(document).off('keydown').on('keydown', function (e) {
                                        if (e.key === ' ') {
                                            e.preventDefault();
                                            ['#Abed1', '#Abed2', '#Abed3'].forEach(id => {
                                                let audioElement = $(id)[0];
                                                if (audioElement && audioElement.duration > 0.5) {
                                                    audioElement.currentTime = audioElement.duration - 0.5;
                                                }
                                            });
                                        }
                                    });
                                    $(document).off('mousemove').on('mousemove', function (e) {
                                        updateCursorPosition2(e, 3000, 6000);
                                    });
                                    $(document).on('mousemove').on('mousemove', function (e) {
                                        updateCursorPosition3(e, 3000, 6000);
                                    });
                                    $('#Abed1')[0].addEventListener('ended', function () {
                                        $('#kakaka').css({
                                            "transform": "scale(1.0)",
                                            "transition": "none"
                                        });
                                        startFollowingCursor();
                                        $('#Abed2')[0].play();
                                        $("#spaceshipBedIntRobot2").css('visibility', 'visible');
                                        $('#Abed2')[0].addEventListener('ended', function () {
                                            $('#Abed3')[0].play();
                                            $("#spaceshipBedIntRobot2").css('display', 'none');
                                            $("#spaceshipBedIntRobot3").css('visibility', 'visible');

                                            $('#Abed3')[0].addEventListener('ended', function () {
                                                stopFollowingCursor();
                                                setTimeout(function () {
                                                    startAnimation();
                                                }, 2030);
                                                $('#kakaka').css({
                                                    "background-image": "url(./images/kakakaD.png)",
                                                    "transform": "scale(1.5)",
                                                    "left": "3200px",
                                                    "top": "6360px",
                                                    "transition": "left 2s, top 2s, transform 2s"
                                                });
                                                $("#buttonKakaka").css('visibility', 'visible');
                                                $("[id='objectifReduc']").nextAll().remove();
                                                $("[id='objectifReduc']").after(`<br><span id="nouvelleTache4">- Prend une arme et casse-lui la boca !</span>`);
                                                $('#buttonKakaka').on('click', function () {
                                                    $('#Atake')[0].play();
                                                    $('#Atake')[0].volume = 0.6;
                                                    $('#Abed4')[0].addEventListener('ended', function () {
                                                        $("#buttonRobot").css('visibility', 'visible');
                                                    });
                                                    $('#kakaka').css({
                                                        "background-image": "url(./images/kakakaD.png)",
                                                        "transform": "scale(1.5)",
                                                        "left": "12200px",
                                                        "top": "6360px",
                                                        "transition": "none"
                                                    });
                                                    $("#spaceshipBedIntRobot3, #buttonKakaka").css('display', 'none');
                                                    $("#spaceshipBedIntRobot4").css('visibility', 'visible');
                                                    $('#Abed4')[0].play();
                                                    $('#buttonRobot').on('click', function () {
                                                        $("#spaceshipBedIntRobot4, #buttonRobot").css('display', 'none');
                                                        const images = [
                                                            '#spaceshipBedIntRobot5',
                                                            '#spaceshipBedIntRobot6',
                                                            '#spaceshipBedIntRobot7',
                                                            '#spaceshipBedIntRobot8'
                                                        ];

                                                        let currentIndex = 0;

                                                        const showNextImage = () => {
                                                            if (currentIndex < images.length - 1) {
                                                                $(images[currentIndex]).css('display', 'none');
                                                            }

                                                            currentIndex++;

                                                            if (currentIndex < images.length) {
                                                                $(images[currentIndex]).css('visibility', 'visible');

                                                                if (images[currentIndex] === '#spaceshipBedIntRobot6') {
                                                                    $('#Afall')[0].play();
                                                                    $('#Afall')[0].volume = 0.8;
                                                                } else if (images[currentIndex] === '#spaceshipBedIntRobot8') {
                                                                    $('#Apunch')[0].play();
                                                                    $('#Apunch')[0].volume = 0.8;
                                                                }
                                                            } else {
                                                                clearInterval(intervalId);
                                                                $(images[images.length - 1]).css('visibility', 'visible');
                                                                setTimeout(function () {
                                                                    $("[id*='nouvelleTache4']").each(function () {
                                                                        $(this).html(function (_, html) {
                                                                            return html.replace('- Prend une arme et casse-lui la boca !', '<span style="color: red;"><del>Prend une arme et casse-lui la boca !</del></span>');
                                                                        });
                                                                    });
                                                                    $('#Amemoire')[0].play();
                                                                    $(document).off('keydown').on('keydown', function (e) {
                                                                        if (e.key === ' ') {
                                                                            e.preventDefault();
                                                                            let audioElement = $('#Amemoire')[0];
                                                                            if (audioElement.duration > 0.5) {
                                                                                audioElement.currentTime = audioElement.duration - 0.5;
                                                                            }
                                                                        }
                                                                    });
                                                                    $("#spaceshipBedIntRobot8").css('display', 'none');
                                                                    $("#spaceshipBedIntRobot9, #button21back, #trans3, #blood").css('visibility', 'visible');
                                                                    $('#kakaka').css({
                                                                        "transform": "scale(1.5)",
                                                                        "left": "3360px",
                                                                        "top": "6220px",
                                                                        "opacity": "0",
                                                                        "transition": "none"
                                                                    });
                                                                    setTimeout(function () {
                                                                        $('#kakaka').css({
                                                                            "opacity": "1",
                                                                            "transition": "opacity 6s"
                                                                        });
                                                                    }, 30);
                                                                    $('#trans3').css({
                                                                        "opacity": "0",
                                                                        "transition": "opacity 6s"
                                                                    });
                                                                    $('#blood').css({
                                                                        "opacity": "0",
                                                                        "transition": "opacity 20s"
                                                                    });
                                                                    $('#Amemoire')[0].addEventListener('ended', function () {
                                                                        $(document).off('mousemove').on('mousemove', function (e) {
                                                                            updateCursorPosition3(e, 3000, 6000);
                                                                        });
                                                                        $(document).on('mousemove').on('mousemove', function (e) {
                                                                            updateCursorPosition2(e, 3000, 6000);
                                                                            $("#button22back").css('visibility', 'visible');
                                                                        });
                                                                    });
                                                                }, 50);
                                                            }
                                                        };
                                                        $(images[currentIndex]).css('visibility', 'visible');
                                                        const intervalId = setInterval(showNextImage, 500);
                                                    });
                                                });
                                            });
                                        });
                                    });
                                }
                            });

                            var next = 0;
                            $('#button22back').on('click', function () {
                                if (next === 1) {
                                    $("#trans3, #blood").css('display', 'none');
                                    $("#button8left, #button8right, #button8front, #button8back").css('visibility', 'hidden');
                                    $('#Adanger')[0].play();
                                    $(document).off('keydown').on('keydown', function (e) {
                                        if (e.key === ' ') {
                                            e.preventDefault();
                                            let audioElement = $('#Adanger')[0];
                                            if (audioElement.duration > 0.5) {
                                                audioElement.currentTime = audioElement.duration - 0.5;
                                            }
                                        }
                                    });
                                    $('#Aalarme2')[0].play();
                                    $('#Aalarme2')[0].volume = 0.6;
                                    $('#spaceshipCoridorRed, #cockpit, #buttonTarget').css('visibility', 'visible');

                                    (function () {
                                        let count = 0;
                                        const toggle = setInterval(() => {
                                            $('#spaceshipCoridorRed').css('visibility', (i, visibility) =>
                                                (count === 5) ? 'hidden' : (visibility === 'visible' ? 'hidden' : 'visible')
                                            );
                                            if (++count === 6) {
                                                clearInterval(toggle);
                                            }
                                        }, 770);
                                    })();

                                    $('#Aalarme2')[0].addEventListener('ended', function () {
                                        disableLoop = true;
                                        $('#spaceshipCoridorRed').css('visibility', 'hidden');
                                    });

                                    $('#Adanger')[0].addEventListener('ended', function () {
                                        $("#button8left, #button8right, #button8front, #button8back").css('visibility', 'visible');
                                        $('#Awar')[0].volume = 0;
                                        $('#Awar')[0].play();
                                        $('#Aambient')[0].pause();
                                        const fadeIn = setInterval(function () {
                                            const audio = $('#Awar')[0];
                                            if (audio.volume < 1) {
                                                audio.volume = Math.min(audio.volume + 0.1, 0.8);
                                            } else {
                                                clearInterval(fadeIn);
                                            }
                                        }, 200);
                                    });

                                    $("[id='objectifReduc']").nextAll().remove();
                                    $("[id='objectifReduc']").after(`<br><span id="nouvelleTache5">- Aller à l'artillerie</span>`);
                                    next = 2;
                                }
                            });

                            $('#button10back, #button22back').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#spaceshipBedIntRobot8").css('display', 'none');
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 3000);
                                });
                            });

                            $('#button8front').on('click', function () {
                                $('#Asteps')[0].play();
                                $('#spaceshipCoridor2').css('visibility', 'visible');
                                $('#button13left, #button13right, #button13front, #button13back').css('visibility', 'visible');
                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                            });

                            $('#button13back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 9000, y: 3000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 3000);
                                });
                            });

                            $('#button13left').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button14front, #button14back, #spaceshipEngine").css('visibility', 'visible');
                                worldView.setPosition({ x: 3000, y: 9000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 3000, 9000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 3000, 9000);
                                });
                            });

                            $('#button14back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 9000);
                                });
                            });

                            $('#button14front').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#buttonFuse").css('visibility', 'visible');
                                $("#button15back, #spaceshipEngineInt").css('visibility', 'visible');
                                worldView.setPosition({ x: 6000, y: 9000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 6000, 9000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 6000, 9000);
                                });
                            });

                            var next2 = 0;
                            var next0 = 0;
                            $('#buttonFuse').on('click', function () {
                                next0 = 1;
                                $('#Afuse1')[0].play();
                                $("#buttonFuse, #buttonFuse1").css('display', 'none');
                                $("[id*='problème']").each(function () {
                                    $(this).html(function (_, html) {
                                        return html.replace('- Identifier la cause de l\'anomalie', '<span style="color: red;"><del>Identifier la cause de l\'anomalie</del></span>');
                                    });
                                });
                                if (next0 === 1 && next2 === 1) {
                                    $('#Afuse1').on('ended', function () {
                                        console.log("La valeur de next0 est :", next0);
                                        console.log("La valeur de next2 est :", next2);
                                        $("#buttonCase").css('visibility', 'visible');
                                        $("[id='objectifReduc']").nextAll().remove();
                                        $("[id='objectifReduc']").after(`<br><span id="nouvelleTache1">- Chercher un fusible</span> <br><span id="nouvelleTache2">- Installer le fusible</span>`);
                                    });
                                }
                            });

                            $('#buttonFuse3').on('click', function () {
                                $('#Afuse')[0].play();
                                $('#Afuse')[0].volume = 0.6;
                                $('#Abed')[0].play();
                                $("#spaceshipEngineInt2").css('visibility', 'visible');
                                $('#spaceshipEngineInt2').css({
                                    left: 6000,
                                    top: 9000
                                });
                                $("#buttonFuse3, #spaceshipEngineInt, #spaceshipEngineIntRed, #button15back").css('display', 'none');
                                $("[id*='nouvelleTache2']").each(function () {
                                    $(this).html(function (_, html) {
                                        return html.replace('- Installer le fusible', '<span style="color: red;"><del>Installer le fusible</del></span>');
                                    });
                                });
                                $(document).off('keydown').on('keydown', function (e) {
                                    if (e.key === ' ') {
                                        e.preventDefault();
                                        let audioElement = $('#Abed')[0];
                                        if (audioElement.duration > 0.5) {
                                            audioElement.currentTime = audioElement.duration - 0.5;
                                        }
                                    }
                                });
                                $('#Abed')[0].addEventListener('ended', function () {
                                    next = 1;
                                    $("#button10back, #spaceshipBedInt, #spaceshipEngineBedIntRed").css('display', 'none');
                                    $("#spaceshipBedIntRobot, #button21back").css('visibility', 'visible');
                                    $('#spaceshipBedIntRobot').css({
                                        left: 3000,
                                        top: 6000
                                    });
                                    $("[id='objectifReduc']").nextAll().remove();
                                    $("[id='objectifReduc']").after(`<br><span id="nouvelleTache3">- Aller dans la chambre</span>`);
                                });
                            });


                            $('#button15back, #button21back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 9000);
                                });
                            });

                            $('#button13right').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button16back, #spaceshipTp").css('visibility', 'visible');
                                worldView.setPosition({ x: 9000, y: 9000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 9000, 9000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 9000);
                                });
                            });

                            $('#button16back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 9000);
                                });
                            });

                            $('#button13front').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button18back, #button18front, #spaceshipHold").css('visibility', 'visible');
                                worldView.setPosition({ x: 50, y: 12000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 12000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 12000);
                                });
                            });

                            $('#button18back').on('click', function () {
                                $('#Asteps')[0].play();
                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 9000);
                                });
                            });

                            $('#button18front').on('click', function () {
                                $('#Asteps')[0].play();
                                $("#button19back, #spaceshipHoldInt").css('visibility', 'visible');
                                worldView.setPosition({ x: 3000, y: 12000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 3000, 12000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 3000, 12000);
                                });

                                $('#buttonCase').on('click', function () {
                                    $('#Asteps')[0].play();
                                    $("#spaceshipHoldIntClose, #buttonCase2").css('visibility', 'visible');
                                    worldView.setPosition({ x: 9000, y: 12000 });
                                    $(document).off('mousemove', function (e) {
                                        updateCursorPosition2(e, 9000, 12000);
                                    });
                                    $(document).on('mousemove', function (e) {
                                        updateCursorPosition3(e, 9000, 12000);
                                    });
                                    $('#buttonCase2').on('click', function () {
                                        $('#AcaseFuse')[0].play();
                                        $('#AcaseOpen')[0].play();
                                        $('#AcaseOpen')[0].volume = 0.4;
                                        $("#spaceshipHoldIntOpen, #buttonFuse2").css('visibility', 'visible');
                                        $("#spaceshipHoldIntClose, #buttonCase2").css('display', 'none');
                                        $('#spaceshipHoldIntOpen').css({
                                            left: 9000,
                                            top: 12000
                                        });
                                        $('#buttonFuse2').on('click', function () {
                                            $('#AcaseClose')[0].play();
                                            $('#AcaseClose')[0].volume = 0.4;
                                            $('#button20back').css({
                                                position: 'absolute',
                                                left: '50%',
                                                top: '87.5%'
                                            });
                                            $("#spaceshipHoldIntOpen").css('display', 'none');
                                            $("#button20back").css('visibility', 'visible');
                                            $("#spaceshipHoldIntClose").css('display', 'block');
                                            $("[id*='nouvelleTache1']").each(function () {
                                                $(this).html(function (_, html) {
                                                    return html.replace('- Chercher un fusible', '<span style="color: red;"><del>Chercher un fusible</del></span>');
                                                });
                                            });
                                            $(document).on('mousemove', function (e) {
                                                updateCursorPosition2(e, 9000, 12000);
                                            });
                                            $(document).off('mousemove', function (e) {
                                                updateCursorPosition3(e, 9000, 12000);
                                            });
                                            $('#button20back').on('click', function () {
                                                $('#Asteps')[0].play();
                                                $("#buttonFuse3").css('visibility', 'visible');
                                                $(document).on('mousemove', function (e) {
                                                    updateCursorPosition2(e, 3000, 12000);
                                                });
                                                worldView.setPosition({ x: 3000, y: 12000 });
                                                $("#spaceshipHoldIntOpen").css('display', 'none');
                                                $("#button20back, #buttonCase").css('display', 'none');
                                                $("#spaceshipHoldIntClose").css('display', 'none');
                                            });
                                        });
                                    });
                                });
                            });


                            $('#button19back').on('click', function () {
                                $('#Asteps')[0].play();

                                worldView.setPosition({ x: 50, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition(e, 50, 9000);
                                });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition2(e, 50, 9000);
                                });
                            });
                            $('#buttonTp').on('click', function () {
                                $('#Alaser')[0].volume = 0.4;
                                $('#Atp')[0].play();
                                $('#Atp')[0].volume = 0.4;
                                $("#buttonTpback, #spaceshipWeapon").css('visibility', 'visible');
                                worldView.setPosition({ x: 6000, y: 12000 });
                                $(document).off('mousemove', function (e) {
                                    updateCursorPosition(e, 6000, 12000);
                                });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 6000, 12000);
                                });

                                next4 = 0;

                                if (next === 2) {
                                    $('#AspaceWar')[0].play();
                                    $("[id='nouvelleTache5']").html(function (_, html) {
                                        return html.replace('- Aller à l\'artillerie', '<span style="color: red;"><del>Aller à l\'artillerie</del></span>');
                                    });
                                    $('#AspaceWar')[0].addEventListener('ended', function () {
                                        $("[id='objectifReduc']").nextAll().remove();
                                        $("[id='objectifReduc']").after(`<br><span id="nouvelleTache6">- Open fire !</span>`);
                                    });

                                    function updateScrollPositionX() {
                                        const transformMatrix = getComputedStyle(document.querySelector('.world')).transform;
                                        if (transformMatrix !== 'none') {
                                            const matrixValues = transformMatrix.split(',');
                                            scrollX = parseFloat(matrixValues[4]) || 0;
                                            scrollY = parseFloat(matrixValues[5]) || 0;
                                        } else {
                                            scrollX = 0;
                                            scrollY = 0;
                                        }
                                    }

                                    let scrollX = 0;
                                    let scrollY = 0;

                                    $(document).ready(function () {
                                        const laser = $('#laser');
                                        const laser1 = $('#laser1');
                                        const laser2 = $('#laser2');
                                        const laserOriginY = window.innerHeight * 0.49;
                                        const laserOriginX = window.innerWidth * 0.5;
                                        const laser1OriginX = laserOriginX - 130;
                                        const laser2OriginX = laserOriginX + 130;
                                        let laserOpacityTimeout;
                                        let lasersEnabled = true;

                                        let lastLaserTime = 0;
                                        const laserCooldown = 700;

                                        function configureLaser(laserElement, originX, targetX, targetY) {
                                            const deltaX = targetX - originX;
                                            const deltaY = targetY - laserOriginY;
                                            const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI) - 90;
                                            const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);

                                            laserElement.css({
                                                visibility: 'visible',
                                                left: originX + 'px',
                                                top: laserOriginY + 'px',
                                                height: distance + 'px',
                                                opacity: 1,
                                                width: '20px',
                                                transform: `translate(-50%, 0) rotate(${angle}deg)`,
                                                clipPath: 'polygon(0% 0%, 100% 0%, 55% 100%, 45% 100%)'
                                            });
                                        }

                                        $(document).on('click', function () {
                                            const currentTime = Date.now();

                                            if (!lasersEnabled || currentTime - lastLaserTime < laserCooldown) {
                                                return;
                                            }

                                            lastLaserTime = currentTime;

                                            updateScrollPositionX();

                                            const targetX = target.offset().left + target.width() / 2;
                                            const targetY = target.offset().top + target.height() / 2;

                                            configureLaser(laser, laserOriginX, targetX, targetY);
                                            configureLaser(laser1, laser1OriginX, targetX, targetY);
                                            configureLaser(laser2, laser2OriginX, targetX, targetY);

                                            clearTimeout(laserOpacityTimeout);

                                            $('#Alaser')[0].currentTime = 0;
                                            $('#Alaser')[0].play();

                                            laserOpacityTimeout = setTimeout(function () {
                                                let opacity = 1;
                                                const fadeOutInterval = setInterval(function () {
                                                    opacity -= 0.05;
                                                    if (opacity <= 0) {
                                                        opacity = 0;
                                                        clearInterval(fadeOutInterval);
                                                    }
                                                    laser.css('opacity', opacity);
                                                    laser1.css('opacity', opacity);
                                                    laser2.css('opacity', opacity);
                                                }, 15);
                                            }, 200);
                                        });

                                        $(document).on('mousemove', function (e) {
                                            if (isFollowingTarget) {
                                                let targetX = e.pageX - target.outerWidth() / 2 - scrollX;
                                                let targetY = e.pageY - target.outerHeight() / 2 - scrollY;

                                                smoothTargetX += (targetX - smoothTargetX) / 20;
                                                smoothTargetY += (targetY - smoothTargetY) / 20;

                                                target.css({
                                                    left: smoothTargetX + 'px',
                                                    top: smoothTargetY + 'px'
                                                });
                                            }
                                        });
                                    });

                                    $(document).ready(function () {
                                        const laserOriginOffset = 90;
                                        const laserCooldown = 5000;

                                        let blueLaserCount = 0;

                                        let cockpitAnimationTimeout;

                                        function createLaser(spaceship) {
                                            const clickCount = parseInt(spaceship.attr('data-click-count'), 10) || 0;

                                            if (clickCount < 7) {
                                                const laser4 = $('<div class="laser4"></div>');
                                                const spaceshipOffset = spaceship.offset();
                                                const laserStartX = spaceshipOffset.left + spaceship.width();
                                                const laserStartY = spaceshipOffset.top + spaceship.height() * 1.5;
                                                const targetX = Math.random() * (window.innerWidth * 0.8) + (window.innerWidth * 0.1);
                                                const targetY = window.innerHeight * 0.65;

                                                laser4.css({
                                                    position: 'absolute',
                                                    left: laserStartX + 'px',
                                                    top: laserStartY + 'px',
                                                    height: '1px',
                                                    width: '60px',
                                                    background: 'blue',
                                                    transformOrigin: 'top',
                                                    opacity: 1,
                                                    transition: 'height 0.5s linear, opacity 0.5s linear',
                                                    clipPath: 'polygon(0% 100%, 100% 100%, 53% 0%, 47% 0%)',
                                                    visibility: 'visible',
                                                    zIndex: 1
                                                });

                                                $('#spaceshipWeaponRed').append(laser4);

                                                const deltaX = targetX - laserStartX;
                                                const deltaY = targetY - laserStartY;
                                                const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
                                                const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI) - 90;

                                                laser4.css({
                                                    height: `${distance}px`,
                                                    transform: `rotate(${angle}deg)`,
                                                    top: laserStartY + 'px',
                                                    left: laserStartX + 'px',
                                                });

                                                blueLaserCount++;

                                                if (blueLaserCount === 6) {
                                                    $("#buttonTp").css('visibility', 'hidden');
                                                    $('#AendWar')[0].play();
                                                    $(document).off('keydown').on('keydown', function (e) {
                                                        if (e.key === ' ') {
                                                            e.preventDefault();
                                                            let audioElement = $('#AendWar')[0];
                                                            if (audioElement.duration > 0.5) {
                                                                audioElement.currentTime = audioElement.duration - 0.5;
                                                            }
                                                        }
                                                    });
                                                    next4 = 1;
                                                    $("[id='nouvelleTache6']").html(function (_, html) {
                                                        return html.replace('- Open fire !', '<span style="color: red;"><del>Open fire !</del></span>');
                                                    });
                                                }

                                                if (next4 === 0) {
                                                    clearTimeout(cockpitAnimationTimeout);
                                                    $('#Ashield')[0].currentTime = 0;
                                                    $('#Ashield')[0].play();
                                                    $('#Ashield')[0].volume = 0.9;
                                                    $('#cockpit2, #shield').stop(true, true).css({ visibility: 'visible', opacity: 1 });

                                                    cockpitAnimationTimeout = setTimeout(function () {
                                                        $('#cockpit2, #shield').animate({ opacity: 0 }, 1500, function () {
                                                            $('#cockpit2, #shield').css('visibility', 'hidden');
                                                        });
                                                    }, 0);
                                                }

                                                laserOpacityTimeout = setTimeout(function () {
                                                    let opacity = 1;
                                                    const fadeOutInterval = setInterval(function () {
                                                        opacity -= 0.05;
                                                        if (opacity <= 0) {
                                                            opacity = 0;
                                                            clearInterval(fadeOutInterval);
                                                        }
                                                        laser4.css('opacity', opacity);
                                                    }, 15);
                                                }, 200);
                                            }
                                        }

                                        let lastClickTime = 0;
                                        const clickCooldown = 650;

                                        function addImage() {
                                            const letters = ['W', 'B', 'G'];
                                            const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                                            const initialImageSuffix = "1";

                                            const imagesWithSuffix1 = $('.spaceship').filter(function () {
                                                return $(this).attr('data-image-prefix') && $(this).css('background-image').includes(`${$(this).attr('data-image-prefix')}1`);
                                            }).length;

                                            if (imagesWithSuffix1 >= 4) {
                                                return;
                                            }

                                            const newImage = $(`<div class="spaceship grow" style="position: absolute; z-index: 0;" data-click-count="0" data-image-prefix="${randomLetter}"></div>`);
                                            newImage.css({
                                                'background-image': `url(./images/${randomLetter}${initialImageSuffix}.png)`,
                                                'background-size': 'cover',
                                                'background-repeat': 'no-repeat',
                                                'width': '4vw',
                                                'height': `${4 * (9 / 16)}vw`,
                                                'pointer-events': 'none',
                                                'top': `${Math.random() * (window.innerHeight * 0.2) + (window.innerHeight * 0.2) - (window.innerHeight * 0.2) / 2}px`,
                                                'left': `${Math.random() * (window.innerWidth * 0.8) + (window.innerWidth * 0.1) - (window.innerWidth * 0.02) / 2}px`,
                                                'transform-origin': 'center',
                                                'visibility': 'visible'
                                            });

                                            const circleSize = 8;
                                            const spaceshipSize = 4;
                                            const offset = (circleSize - spaceshipSize) / 2;

                                            const circleImage = $('<div class="circle"></div>');
                                            circleImage.css({
                                                'transform-origin': 'center',
                                                'background-image': 'url(./images/cercle.png)',
                                                'background-size': 'cover',
                                                'background-repeat': 'no-repeat',
                                                'position': 'absolute',
                                                'width': `${circleSize}vw`,
                                                'height': `${circleSize}vw`,
                                                'top': `calc(${newImage.css('top')} - ${offset + 0.5}vw)`,
                                                'left': `calc(${newImage.css('left')} - ${offset}vw)`,
                                                'visibility': 'visible',
                                                'opacity': 1,
                                                'z-index': 0,
                                            });

                                            $('#spaceshipWeaponRed').append(circleImage, newImage);

                                            circleImage.animate({ opacity: 0 }, 400, function () {
                                                circleImage.remove();
                                            });
                                            setTimeout(() => {
                                                createLaser(newImage);
                                                setInterval(() => createLaser(newImage), laserCooldown);
                                            }, 20000);
                                        }

                                        function checkHoverAndChangeImage(event) {
                                            const target = $('#target');
                                            const targetCenterX = target.offset().left + target.width() / 2;
                                            const targetCenterY = target.offset().top + target.height() / 2;

                                            $('.spaceship').each(function () {
                                                const spaceship = $(this);
                                                const rect = spaceship[0].getBoundingClientRect();
                                                const spaceshipLeft = rect.left;
                                                const spaceshipTop = rect.top;
                                                const spaceshipRight = spaceshipLeft + rect.width;
                                                const spaceshipBottom = spaceshipTop + rect.height;

                                                if (
                                                    targetCenterX >= spaceshipLeft &&
                                                    targetCenterX <= spaceshipRight &&
                                                    targetCenterY >= spaceshipTop &&
                                                    targetCenterY <= spaceshipBottom
                                                ) {
                                                    let clickCount = parseInt(spaceship.attr('data-click-count'), 10) || 0;
                                                    clickCount++;
                                                    spaceship.attr('data-click-count', clickCount);

                                                    const imagePrefix = spaceship.attr('data-image-prefix');
                                                    let newImageSuffix;

                                                    if (clickCount === 2) {
                                                        newImageSuffix = 2;
                                                    } else if (clickCount === 4) {
                                                        newImageSuffix = 3;
                                                    } else if (clickCount === 7) {
                                                        newImageSuffix = 4;
                                                        spaceship.css({
                                                            width: `${rect.width}px`,
                                                            height: `${rect.height}px`,
                                                            left: `${spaceshipLeft}px`,
                                                            top: `${spaceshipTop}px`,
                                                        });
                                                        spaceship.off('click');
                                                        spaceship.removeClass('grow');
                                                    }

                                                    if (newImageSuffix) {
                                                        const newBackgroundImage = `url(./images/${imagePrefix}${newImageSuffix}.png)`;
                                                        spaceship.css('background-image', newBackgroundImage);
                                                    }
                                                }
                                            });
                                        }
                                        setTimeout(function () {
                                            addImage();
                                        }, 5000);

                                        setInterval(addImage, 5000);

                                        $(document).on('click', function (event) {
                                            const currentTime = Date.now();

                                            if (currentTime - lastClickTime < clickCooldown) {
                                                return;
                                            }

                                            lastClickTime = currentTime;

                                            checkHoverAndChangeImage(event);
                                        });

                                        buttonTarget.on('mouseenter', function () {
                                            isFollowingTarget = true;
                                            target.css('visibility', 'visible');
                                        });

                                        buttonTarget.on('mouseleave', function () {
                                            isFollowingTarget = false;
                                            target.css('visibility', 'hidden');
                                            $('#cursorImage').css('visibility', 'visible');
                                            $(document).on('mousemove', CursorImage);
                                        });

                                    });

                                    let smoothTargetX = 0;
                                    let smoothTargetY = 0;
                                    let isFollowingTarget = false;

                                    const buttonTarget = $('#buttonTarget');
                                    const target = $('#target');

                                    $(document).on('mousemove', function (e) {
                                        if (isFollowingTarget) {
                                            updateScrollPositionX();

                                            let targetX = e.pageX - target.outerWidth() / 2 - scrollX;
                                            let targetY = e.pageY - target.outerHeight() / 2 - scrollY;

                                            smoothTargetX += (targetX - smoothTargetX) / 20;
                                            smoothTargetY += (targetY - smoothTargetY) / 20;

                                            target.css({
                                                left: smoothTargetX + 'px',
                                                top: smoothTargetY + 'px'
                                            });
                                        }
                                    });
                                }
                            });

                            $('#buttonTpback').on('click', function () {
                                $('#Atp')[0].play();
                                $('#Atp')[0].volume = 0.3;
                                worldView.setPosition({ x: 9000, y: 9000 });
                                $(document).on('mousemove', function (e) {
                                    updateCursorPosition2(e, 9000, 9000);
                                });
                                $('#Alaser')[0].volume = 0;
                                if (next4 === 1) {
                                    lasersEnabled = false;
                                    $("[id='objectifReduc']").nextAll().remove();
                                    $("[id='objectifReduc']").after(`<br><span id="nouvelleTache7">- Fuyez, pauvres fous !!</span>`);
                                }
                            });
                        });
                    });
                });
            });
        });
    </script>
</body>
</html>


